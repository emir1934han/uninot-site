<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Not SatÄ±n Al | UniNot</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Anasayfa.css">
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <i class="fa-solid fa-graduation-cap"></i> UniNot
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Anasayfa</a></li>
                <li><a href="notpaylas.html">Not PaylaÅŸ</a></li> 
                <li><a href="kredilerim.html">Kredilerim</a></li>
                <li><a href="kayit.html" class="btn-register" id="navAuthBtn">KayÄ±t Ol</a></li>
            </ul>
            <div class="hamburger">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <h1>AradÄ±ÄŸÄ±n Dersi Bul ğŸ“š</h1>
            <p>Binlerce ders notu arasÄ±nda arama yap, eksiklerini tamamla.</p>
            <div class="search-bar">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="searchInput" placeholder="Ders adÄ±, Ã¼niversite veya konu ara...">
                <button onclick="searchNotes()">Ara</button>
            </div>
        </div>
    </header>

    <section class="shop-section">
        <div class="container shop-layout">
            
            <aside class="sidebar">
                <div class="filter-group">
                    <h3>Kategoriler</h3>
                    <ul>
                        <li><input type="checkbox" id="cat1"> <label for="cat1">Bilgisayar MÃ¼h.</label></li>
                        <li><input type="checkbox" id="cat2"> <label for="cat2">Hukuk</label></li>
                        <li><input type="checkbox" id="cat3"> <label for="cat3">TÄ±p</label></li>
                        <li><input type="checkbox" id="cat4"> <label for="cat4">Ä°ÅŸletme</label></li>
                        <li><input type="checkbox" id="cat5"> <label for="cat5">Psikoloji</label></li>
                    </ul>
                </div>

                <div class="filter-group">
                    <h3>Fiyat AralÄ±ÄŸÄ±</h3>
                    <div class="price-range">
                        <input type="range" min="0" max="500">
                        <div class="price-labels">
                            <span>0â‚º</span>
                            <span>500â‚º</span>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <h3>Puan</h3>
                    <ul>
                        <li><input type="radio" name="star"> <label>â­â­â­â­â­ (5)</label></li>
                        <li><input type="radio" name="star"> <label>â­â­â­â­ (4+)</label></li>
                        <li><input type="radio" name="star"> <label>â­â­â­ (3+)</label></li>
                    </ul>
                </div>
            </aside>

            <main class="notes-grid" id="notesContainer">
                
                <div class="note-card">
                    <div class="card-image">
                        <span class="badge-price">50â‚º</span>
                        <i class="fa-regular fa-file-pdf"></i>
                    </div>
                    <div class="card-body">
                        <div class="university">Ä°stanbul Ãœniversitesi</div>
                        <h3>Medeni Hukuk GiriÅŸ</h3>
                        <div class="author">
                            <i class="fa-solid fa-user-pen"></i> Emirhan Y.
                        </div>
                        <div class="rating">
                            <i class="fa-solid fa-star"></i> 4.8 (120 Ä°ndirme)
                        </div>
                        <a href="#" class="btn-buy">DetaylarÄ± GÃ¶r</a>
                    </div>
                </div>

                <div class="note-card">
                    <div class="card-image color-blue">
                        <span class="badge-price">Ãœcretsiz</span>
                        <i class="fa-solid fa-code"></i>
                    </div>
                    <div class="card-body">
                        <div class="university">ODTÃœ</div>
                        <h3>Python ile Veri YapÄ±larÄ±</h3>
                        <div class="author">
                            <i class="fa-solid fa-user-pen"></i> AyÅŸe K.
                        </div>
                        <div class="rating">
                            <i class="fa-solid fa-star"></i> 5.0 (340 Ä°ndirme)
                        </div>
                        <a href="#" class="btn-buy">DetaylarÄ± GÃ¶r</a>
                    </div>
                </div>

                <div class="note-card">
                    <div class="card-image color-green">
                        <span class="badge-price">75â‚º</span>
                        <i class="fa-solid fa-dna"></i>
                    </div>
                    <div class="card-body">
                        <div class="university">Hacettepe TÄ±p</div>
                        <h3>Anatomi - Kemikler</h3>
                        <div class="author">
                            <i class="fa-solid fa-user-pen"></i> Mehmet D.
                        </div>
                        <div class="rating">
                            <i class="fa-solid fa-star"></i> 4.5 (85 Ä°ndirme)
                        </div>
                        <a href="#" class="btn-buy">DetaylarÄ± GÃ¶r</a>
                    </div>
                </div>

                 <div class="note-card">
                    <div class="card-image color-purple">
                        <span class="badge-price">30â‚º</span>
                        <i class="fa-solid fa-calculator"></i>
                    </div>
                    <div class="card-body">
                        <div class="university">Ä°TÃœ</div>
                        <h3>Lineer Cebir NotlarÄ±</h3>
                        <div class="author">
                            <i class="fa-solid fa-user-pen"></i> Zeynep A.
                        </div>
                        <div class="rating">
                            <i class="fa-solid fa-star"></i> 4.2 (50 Ä°ndirme)
                        </div>
                        <a href="#" class="btn-buy">DetaylarÄ± GÃ¶r</a>
                    </div>
                </div>
                </main>
        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-brand">
                <h2>UniNot</h2>
                <p>Ã–ÄŸrencilerin dijital kÃ¼tÃ¼phanesi ve gelir kapÄ±sÄ±.</p>
                <div class="social-links">
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="footer-menu">
                <h3>Platform</h3>
                <ul>
                    <li><a href="#">NasÄ±l Ã‡alÄ±ÅŸÄ±r?</a></li>
                    <li><a href="#">Not Ara</a></li>
                    <li><a href="#">FiyatlandÄ±rma</a></li>
                </ul>
            </div>
            <div class="footer-menu">
                <h3>Kurumsal</h3>
                <ul>
                    <li><a href="#">HakkÄ±mÄ±zda</a></li>
                    <li><a href="#">Ä°letiÅŸim</a></li>
                    <li><a href="#">Gizlilik PolitikasÄ±</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 UniNot. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        </div>
    </footer>

    <script src="script.js"></script>

    <script type="module">
        import { supabase } from './supabase.js';

        const notesContainer = document.getElementById('notesContainer');
        const navAuthBtn = document.getElementById('navAuthBtn');

        // 1. KullanÄ±cÄ± GiriÅŸ Durumu KontrolÃ¼ (Navbar iÃ§in)
        async function checkUser() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                navAuthBtn.innerText = "HesabÄ±m";
                navAuthBtn.href = "kredilerim.html";
            }
        }
        checkUser();

        // 2. NotlarÄ± VeritabanÄ±ndan Ã‡ekme ve LÄ°STEYE EKLEME
        async function fetchNotes(searchTerm = "") {
            let query = supabase.from('notes').select('*');

            if (searchTerm) {
                query = query.ilike('lesson_name', `%${searchTerm}%`);
            }

            const { data: notes, error } = await query;

            if (error) {
                console.error("Hata:", error);
                return;
            }

            // Mevcut statik notlarÄ± silmeden, sadece yeni gelenleri ekliyoruz (Append)
            if (notes.length > 0) {
                notes.forEach(note => {
                    const colors = ['', 'color-blue', 'color-green', 'color-purple'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    const cardHTML = `
                    <div class="note-card">
                        <div class="card-image ${randomColor}">
                            <span class="badge-price">${note.price == 0 ? 'Ãœcretsiz' : note.price + 'â‚º'}</span>
                            <i class="fa-regular fa-file-pdf"></i>
                        </div>
                        <div class="card-body">
                            <div class="university">${note.university || 'Genel'}</div>
                            <h3>${note.lesson_name}</h3>
                            <div class="author">
                                <i class="fa-solid fa-user-pen"></i> ${note.category}
                            </div>
                            <div class="rating">
                                <i class="fa-solid fa-star"></i> Yeni
                            </div>
                            <a href="${note.file_url}" target="_blank" class="btn-buy">Ä°ndir / Ä°ncele</a>
                        </div>
                    </div>
                    `;
                    // Ekleme yapÄ±yoruz (+=) silmiyoruz
                    notesContainer.innerHTML += cardHTML;
                });
            }
        }

        // Sayfa aÃ§Ä±lÄ±nca notlarÄ± getir
        fetchNotes();

        // Arama yapÄ±nca Ã§alÄ±ÅŸacak kod (Arama yapÄ±nca listeyi temizleyip arananÄ± getirmek mantÄ±klÄ±dÄ±r)
        window.searchNotes = function() {
            const val = document.getElementById('searchInput').value;
            // Sadece arama yapÄ±ldÄ±ÄŸÄ±nda listeyi temizler, yoksa statik notlar karÄ±ÅŸÄ±r
            if(val) notesContainer.innerHTML = ""; 
            fetchNotes(val);
        }
    </script>
</body>
</html>