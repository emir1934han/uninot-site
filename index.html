<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniNot | Ãœniversite Not PaylaÅŸÄ±m Platformu</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Anasayfa.css">
    
    <style>
        /* Ä°statistik KutularÄ± Ä°Ã§in Ek Stil */
        .stats-section {
            padding: 60px 0;
            background: #f8fafc;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            text-align: center;
        }
        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4f46e5;
            margin: 10px 0;
        }
        .stat-label { color: #64748b; font-weight: 500; }
        .stat-icon { font-size: 2rem; color: #cbd5e1; margin-bottom: 10px; }

        /* Vitrin (Son Eklenenler) */
        .showcase-section { padding: 60px 0; }
        .section-header { text-align: center; margin-bottom: 40px; }
        .section-header h2 { font-size: 2rem; color: #1e293b; margin-bottom: 10px; }
        .section-header p { color: #64748b; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <i class="fa-solid fa-graduation-cap"></i> UniNot
            </div>
            <ul class="nav-links">
                <li><a href="index.html" class="active">Anasayfa</a></li>
                <li><a href="not-al.html">Not SatÄ±n Al</a></li>
                <li><a href="notpaylas.html">Not PaylaÅŸ</a></li>
                <li><a href="Kayit.html" class="btn-register" id="navAuthBtn">KayÄ±t Ol</a></li>
            </ul>
            <div class="hamburger">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </nav>

    <header class="hero-section">
        <div class="container hero-content">
            <div class="hero-text">
                <h1>Ders NotlarÄ±na <br> Kolayca UlaÅŸ ðŸš€</h1>
                <p>Ãœniversite notlarÄ±nÄ± paylaÅŸ, eksiklerini tamamla ve gelir elde et. Ã–ÄŸrencilerin dijital buluÅŸma noktasÄ±.</p>
                <div class="hero-buttons">
                    <a href="not-al.html" class="btn-primary">Not Ara</a>
                    <a href="notpaylas.html" class="btn-secondary">Not Sat</a>
                </div>
            </div>
            <div class="hero-image">
                <i class="fa-solid fa-book-open-reader" style="font-size: 15rem; color: rgba(255,255,255,0.2);"></i>
            </div>
        </div>
    </header>

    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-file-pdf"></i></div>
                    <div class="stat-number" id="countNotes">...</div>
                    <div class="stat-label">PaylaÅŸÄ±lan Not</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
                    <div class="stat-number" id="countUsers">...</div>
                    <div class="stat-label">Ã–ÄŸrenci</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-download"></i></div>
                    <div class="stat-number" id="countDownloads">...</div>
                    <div class="stat-label">Ä°ndirme</div>
                </div>
            </div>
        </div>
    </section>

    <section class="showcase-section">
        <div class="container">
            <div class="section-header">
                <h2>Yeni Eklenen Notlar ðŸ”¥</h2>
                <p>Platforma yÃ¼klenen en gÃ¼ncel ders materyalleri.</p>
            </div>

            <div class="notes-grid" id="featuredNotes">
                <p style="text-align:center; width:100%;">YÃ¼kleniyor...</p>
            </div>

            <div style="text-align:center; margin-top: 40px;">
                <a href="not-al.html" class="btn-secondary" style="color:#4f46e5; border:1px solid #4f46e5;">TÃ¼mÃ¼nÃ¼ GÃ¶r</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-brand">
                <h2>UniNot</h2>
                <p>Ã–ÄŸrencilerin dijital kÃ¼tÃ¼phanesi ve gelir kapÄ±sÄ±.</p>
            </div>
            <div class="footer-menu">
                <h3>HÄ±zlÄ± EriÅŸim</h3>
                <ul>
                    <li><a href="not-al.html">Not Ara</a></li>
                    <li><a href="notpaylas.html">Not PaylaÅŸ</a></li>
                    <li><a href="Kayit.html">KayÄ±t Ol</a></li>
                </ul>
            </div>
            <div class="copyright">
                <p>&copy; 2025 UniNot. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import { supabase } from './supabase.js';

        const navAuthBtn = document.getElementById('navAuthBtn');
        const countNotes = document.getElementById('countNotes');
        const countUsers = document.getElementById('countUsers');
        const countDownloads = document.getElementById('countDownloads');
        const featuredNotes = document.getElementById('featuredNotes');

        // 1. KULLANICI GÄ°RÄ°Åž KONTROLÃœ
        async function checkUser() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                navAuthBtn.innerText = "HesabÄ±m";
                navAuthBtn.href = "kredilerim.html";
                navAuthBtn.style.background = "#4f46e5";
                navAuthBtn.style.color = "white";
            }
        }
        checkUser();

        // 2. Ä°STATÄ°STÄ°KLERÄ° GETÄ°R
        async function loadStats() {
            try {
                // A) Not SayÄ±sÄ±
                const { count: notesCount } = await supabase
                    .from('notes')
                    .select('*', { count: 'exact', head: true });

                // B) Ã–ÄŸrenci SayÄ±sÄ± (Profiller)
                const { count: usersCount } = await supabase
                    .from('profiles')
                    .select('*', { count: 'exact', head: true });

                // C) Toplam Ä°ndirme (Sales Count ToplamÄ±)
                // Bunun iÃ§in tÃ¼m notlarÄ±n sales_count'unu Ã§ekip toplayacaÄŸÄ±z.
                const { data: downloadData } = await supabase
                    .from('notes')
                    .select('sales_count');
                
                let totalDownloads = 0;
                if(downloadData) {
                    totalDownloads = downloadData.reduce((sum, item) => sum + (item.sales_count || 0), 0);
                }

                // Ekrana Yaz (Animasyonlu gibi gÃ¶rÃ¼nsÃ¼n diye 0'dan baÅŸlatmÄ±yoruz, direkt yazÄ±yoruz)
                countNotes.innerText = notesCount || 0;
                countUsers.innerText = usersCount || 0;
                countDownloads.innerText = totalDownloads || 0;

            } catch (err) {
                console.error("Ä°statistik hatasÄ±:", err);
            }
        }
        loadStats();

        // 3. VÄ°TRÄ°NE SON 3 NOTU GETÄ°R
        async function loadFeaturedNotes() {
            const { data: notes, error } = await supabase
                .from('notes')
                .select('*, profiles(full_name)')
                .order('created_at', { ascending: false })
                .limit(3); // Sadece son 3 not

            if (error) {
                featuredNotes.innerHTML = "Notlar yÃ¼klenemedi.";
                return;
            }

            renderNotes(notes);
        }

        function renderNotes(notes) {
            featuredNotes.innerHTML = "";
            
            if(!notes || notes.length === 0) {
                featuredNotes.innerHTML = "<p>HenÃ¼z not yÃ¼klenmemiÅŸ.</p>";
                return;
            }

            notes.forEach(note => {
                const colors = ['', 'color-blue', 'color-green', 'color-purple'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Yazar AdÄ±
                let authorName = "Anonim";
                if(note.profiles && note.profiles.full_name) authorName = note.profiles.full_name;

                const cardHTML = `
                <div class="note-card">
                    <div class="card-image ${randomColor}">
                        <span class="badge-price">${note.price == 0 ? 'Ãœcretsiz' : note.price + 'â‚º'}</span>
                        <i class="fa-regular fa-file-pdf"></i>
                    </div>
                    <div class="card-body">
                        <div class="university">${note.university || 'Genel'}</div>
                        <h3>${note.lesson_name}</h3>
                        <div class="author-badge">
                             <i class="fa-solid fa-user-pen"></i> ${authorName}
                        </div>
                        <a href="not-al.html" class="btn-buy" style="text-align:center; display:block; text-decoration:none;">Ä°ncele</a>
                    </div>
                </div>
                `;
                featuredNotes.innerHTML += cardHTML;
            });
        }
        loadFeaturedNotes();

    </script>
</body>
</html>