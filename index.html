<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniNot | Ã–ÄŸrenci Not PaylaÅŸÄ±m Platformu</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Anasayfa.css">

    <style>
        .note-preview-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: 0.3s;
            text-align: left;
            /* Not detaylarÄ± sola yaslÄ± daha iyi durur */
            border: 1px solid #f1f5f9;
        }

        .note-preview-card:hover {
            transform: translateY(-5px);
        }

        .note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #64748b;
        }

        .note-price {
            font-weight: 700;
            color: #4f46e5;
            font-size: 1.1rem;
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <i class="fa-solid fa-graduation-cap"></i> UniNot
            </div>
            <ul class="nav-links">
                <li><a href="notpaylas.html">Not PaylaÅŸ</a></li>
                <li><a href="not-al.html">Not SatÄ±n Al</a></li>
                <li><a href="kredilerim.html">Kredilerim</a></li>
                <li><a href="Kayit.html" class="btn-register" id="navAuthBtn">KayÄ±t Ol</a></li>
            </ul>
            <div class="hamburger">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </nav>

    <header class="hero">
        <div class="overlay"></div>
        <div class="container hero-content">
            <span class="badge">ðŸš€ Ã–ÄŸrenciler iÃ§in Gelir KapÄ±sÄ±</span>
            <h1>Ders NotlarÄ±nÄ± <br> <span class="highlight">Kazanca DÃ¶nÃ¼ÅŸtÃ¼r</span></h1>
            <p>Ãœniversite notlarÄ±n tozlu raflarda kalmasÄ±n. Ä°htiyacÄ± olanlara sat, kredi kazan veya eksik ders notlarÄ±nÄ±
                anÄ±nda tamamla.</p>
            <div class="hero-buttons">
                <a href="not-al.html" class="btn btn-primary"><i class="fa-solid fa-magnifying-glass"></i> Not Ara</a>
                <a href="notpaylas.html" class="btn btn-secondary"><i class="fa-solid fa-cloud-arrow-up"></i> Not
                    YÃ¼kle</a>
            </div>
        </div>
    </header>

    <section class="stats">
        <div class="container stats-grid">
            <div class="stat-item">
                <h3 id="statNotes">...</h3>
                <p>PaylaÅŸÄ±lan Not</p>
            </div>
            <div class="stat-item">
                <h3 id="statUnis">...</h3>
                <p>Ãœniversite</p>
            </div>
            <div class="stat-item">
                <h3 id="statEarnings">...</h3>
                <p>Ã–ÄŸrenci KazancÄ±</p>
            </div>
        </div>
    </section>

    <section class="features" style="background-color: #f8fafc;">
        <div class="container">
            <div class="section-title">
                <h2>Vitrine Yeni DÃ¼ÅŸenler ðŸ”¥</h2>
                <p>En son paylaÅŸÄ±lan ders notlarÄ±nÄ± keÅŸfet.</p>
            </div>
            <div class="features-grid" id="showcaseGrid">
                <p style="text-align:center; grid-column:1/-1;">Notlar yÃ¼kleniyor...</p>
            </div>

            <div style="text-align:center; margin-top:40px;">
                <a href="not-al.html" class="btn btn-secondary"
                    style="background:transparent; color:#4f46e5; border:1px solid #4f46e5;">TÃ¼mÃ¼nÃ¼ GÃ¶r</a>
            </div>
        </div>
    </section>

    <section class="features" id="features">
        <div class="container">
            <div class="section-title">
                <h2>Neden UniNot?</h2>
                <p>Daha verimli Ã§alÄ±ÅŸman ve kazanman iÃ§in tasarlandÄ±.</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="icon-box color-1">
                        <i class="fa-solid fa-file-pdf"></i>
                    </div>
                    <h3>Kolayca YÃ¼kle</h3>
                    <p>Ders notlarÄ±nÄ± PDF formatÄ±nda saniyeler iÃ§inde yÃ¼kle, fiyatÄ±nÄ± sen belirle.</p>
                </div>
                <div class="feature-card">
                    <div class="icon-box color-2">
                        <i class="fa-solid fa-download"></i>
                    </div>
                    <h3>AnÄ±nda Ä°ndir</h3>
                    <p>KaÃ§Ä±rdÄ±ÄŸÄ±n veya eksik olduÄŸun derslerin Ã¶zetlerine uygun fiyatlarla ulaÅŸ.</p>
                </div>
                <div class="feature-card">
                    <div class="icon-box color-3">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                    <h3>Gelir Elde Et</h3>
                    <p>NotlarÄ±n her indirildiÄŸinde cÃ¼zdanÄ±na kredi yansÄ±sÄ±n, nakite Ã§evir.</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-brand">
                <h2>UniNot</h2>
                <p>Ã–ÄŸrencilerin dijital kÃ¼tÃ¼phanesi ve gelir kapÄ±sÄ±.</p>
                <div class="social-links">
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="footer-menu">
                <h3>Platform</h3>
                <ul>
                    <li><a href="not-al.html">Not Ara</a></li>
                    <li><a href="notpaylas.html">Not PaylaÅŸ</a></li>
                    <li><a href="Kayit.html">KayÄ±t Ol</a></li>
                </ul>
            </div>
            <div class="footer-menu">
                <h3>Kurumsal</h3>
                <ul>
                    <li><a href="hakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a></li>
                    <li><a href="iletisim.html">Ä°letiÅŸim</a></li>
                    <li><a href="gizlilik.html">Gizlilik PolitikasÄ±</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 UniNot. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        </div>
    </footer>

    <script src="script.js"></script>

    <script type="module">
        import { supabase } from './supabase.js';

        const authBtn = document.getElementById('navAuthBtn');
        const statNotes = document.getElementById('statNotes');
        const statUnis = document.getElementById('statUnis');
        const statEarnings = document.getElementById('statEarnings');
        const showcaseGrid = document.getElementById('showcaseGrid');

        // 1. GÄ°RÄ°Åž KONTROLÃœ (Navbar)
        async function checkUser() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user && authBtn) {
                authBtn.innerText = "HesabÄ±m";
                authBtn.href = "kredilerim.html";
                authBtn.style.backgroundColor = "#4f46e5"; // GiriÅŸ yapÄ±nca renk deÄŸiÅŸsin
                authBtn.style.color = "#fff";
            }
        }
        checkUser();

        // 2. CANLI Ä°STATÄ°STÄ°KLER
        async function loadStats() {
            try {
                // Not SayÄ±sÄ±
                const { count: notesCount } = await supabase
                    .from('notes')
                    .select('*', { count: 'exact', head: true });

                statNotes.innerText = (notesCount || 0) + "+";

                // Ãœniversite SayÄ±sÄ± (Benzersizleri saymak iÃ§in)
                const { data: uniData } = await supabase.from('notes').select('university');
                const uniqueUnis = new Set(uniData.map(n => n.university).filter(u => u)); // BoÅŸ olmayanlarÄ± say
                statUnis.innerText = uniqueUnis.size + "+";

                // KazanÃ§ Hesaplama (SatÄ±ÅŸ SayÄ±sÄ± * Fiyat)
                // Basitlik olsun diye ÅŸimdilik toplam indirme sayÄ±sÄ±nÄ± baz alalÄ±m veya sales_count toplayalÄ±m
                const { data: salesData } = await supabase.from('notes').select('sales_count, price');

                let totalMoney = 0;
                if (salesData) {
                    // Toplam KazanÃ§ = (Fiyat * SatÄ±ÅŸ Adedi) toplamÄ±
                    totalMoney = salesData.reduce((acc, curr) => acc + (curr.price * (curr.sales_count || 0)), 0);
                }

                // SayÄ±yÄ± formatla (Ã¶rn: 1.200 â‚º)
                statEarnings.innerText = "â‚º" + totalMoney.toLocaleString('tr-TR');

            } catch (err) {
                console.error("Ä°statistik hatasÄ±:", err);
            }
        }
        loadStats();

        // 3. VÄ°TRÄ°N (YENÄ° EKLENEN 3 NOT)
        async function loadShowcase() {
            // NotlarÄ± Ã§ek, yazarlarÄ± da al (! iÅŸaretiyle iliÅŸkiyi belirttik)
            const { data: notes, error } = await supabase
                .from('notes')
                .select('*, profiles!notes_author_id_fkey(full_name)')
                .order('created_at', { ascending: false })
                .limit(3);

            if (error) {
                console.error(error);
                showcaseGrid.innerHTML = "";
                return;
            }

            if (!notes || notes.length === 0) {
                showcaseGrid.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>HenÃ¼z not yÃ¼klenmemiÅŸ.</p>";
                return;
            }

            // HTML OluÅŸtur (Senin Feature Card tasarÄ±mÄ±na benzer ama not iÃ§in Ã¶zelleÅŸtirilmiÅŸ)
            showcaseGrid.innerHTML = "";

            notes.forEach(note => {
                let authorName = "Anonim";
                if (note.profiles && note.profiles.full_name) authorName = note.profiles.full_name;

                const cardHTML = `
                <div class="note-preview-card">
                    <div class="icon-box color-1" style="width:50px; height:50px; font-size:1.2rem; margin-bottom:15px;">
                        <i class="fa-solid fa-file-pdf"></i>
                    </div>
                    <h3 style="font-size:1.2rem; margin-bottom:5px;">${note.lesson_name}</h3>
                    <p style="font-size:0.9rem; color:#64748b; margin-bottom:15px;">${note.university || 'Genel'}</p>
                    
                    <div class="note-meta">
                        <span><i class="fa-solid fa-user"></i> ${authorName}</span>
                        <span class="note-price">${note.price == 0 ? 'Ãœcretsiz' : note.price + ' â‚º'}</span>
                    </div>
                    <a href="not-al.html" style="display:block; margin-top:15px; text-decoration:none; color:#4f46e5; font-weight:600; font-size:0.9rem;">
                        Ä°ncele <i class="fa-solid fa-arrow-right"></i>
                    </a>
                </div>
                `;
                showcaseGrid.innerHTML += cardHTML;
            });
        }
        loadShowcase();

    </script>
</body>

</html>