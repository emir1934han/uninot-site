<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniNot | Ãœniversite Not PaylaÅŸÄ±m Platformu</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Anasayfa.css">
    
    <style>
        /* Ä°statistik KutularÄ± Animasyonu */
        .stat-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        /* Vitrin KartlarÄ± */
        .showcase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        /* BÃ¶lÃ¼m BaÅŸlÄ±klarÄ± */
        .section-header {
            text-align: center;
            max-width: 700px;
            margin: 0 auto 50px;
        }
        .section-header h2 {
            font-size: 2.2rem;
            color: #1e293b;
            margin-bottom: 15px;
        }
        .section-header p {
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Neden Biz BÃ¶lÃ¼mÃ¼ */
        .features-section {
            padding: 80px 0;
            background: #fff;
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }
        .feature-box {
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
        }
        .feature-icon {
            width: 70px; height: 70px;
            background: #e0e7ff;
            color: #4f46e5;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <i class="fa-solid fa-graduation-cap"></i> UniNot
            </div>
            <ul class="nav-links">
                <li><a href="index.html" class="active">Anasayfa</a></li>
                <li><a href="not-al.html">Not SatÄ±n Al</a></li>
                <li><a href="notpaylas.html">Not PaylaÅŸ</a></li>
                <li><a href="Kayit.html" class="btn-register" id="navAuthBtn">KayÄ±t Ol</a></li>
            </ul>
            <div class="hamburger">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </nav>

    <header class="hero-section">
        <div class="container hero-content">
            <div class="hero-text">
                <span class="hero-tag">ðŸš€ Ã–ÄŸrencilerin Yeni Gelir KapÄ±sÄ±</span>
                <h1>Ders NotlarÄ±nÄ± <br> Kazanca DÃ¶nÃ¼ÅŸtÃ¼r</h1>
                <p>Ãœniversite notlarÄ±nÄ± paylaÅŸarak pasif gelir elde et veya eksik derslerini tamamlamak iÃ§in en iyi kaynaklara ulaÅŸ.</p>
                <div class="hero-buttons">
                    <a href="not-al.html" class="btn-primary"><i class="fa-solid fa-magnifying-glass"></i> Not Ara</a>
                    <a href="notpaylas.html" class="btn-secondary"><i class="fa-solid fa-upload"></i> Not YÃ¼kle</a>
                </div>
                
                <div class="trust-badges" style="margin-top: 30px; display:flex; gap:20px; align-items:center; color:#64748b; font-size:0.9rem;">
                    <span><i class="fa-solid fa-check-circle" style="color:#16a34a;"></i> OnaylÄ± Ãœyelik</span>
                    <span><i class="fa-solid fa-check-circle" style="color:#16a34a;"></i> GÃ¼venli Ã–deme</span>
                </div>
            </div>
            
            <div class="hero-image">
                <i class="fa-solid fa-book-open-reader" style="font-size: 18rem; color: rgba(255,255,255,0.15); filter: drop-shadow(0 0 20px rgba(79,70,229,0.3));"></i>
            </div>
        </div>
    </header>

    <section class="stats-section" style="padding: 60px 0; background: #f8fafc;">
        <div class="container">
            <div class="stats-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; text-align: center;">
                
                <div class="stat-card" style="background:white; padding:40px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size:2.5rem; color:#4f46e5; margin-bottom:15px;"><i class="fa-regular fa-file-pdf"></i></div>
                    <div class="stat-number" id="countNotes" style="font-size:3rem; font-weight:700; color:#1e293b;">...</div>
                    <div class="stat-label" style="color:#64748b; font-weight:500;">PaylaÅŸÄ±lan Not</div>
                </div>

                <div class="stat-card" style="background:white; padding:40px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size:2.5rem; color:#16a34a; margin-bottom:15px;"><i class="fa-solid fa-users"></i></div>
                    <div class="stat-number" id="countUsers" style="font-size:3rem; font-weight:700; color:#1e293b;">...</div>
                    <div class="stat-label" style="color:#64748b; font-weight:500;">Mutlu Ã–ÄŸrenci</div>
                </div>

                <div class="stat-card" style="background:white; padding:40px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size:2.5rem; color:#f59e0b; margin-bottom:15px;"><i class="fa-solid fa-cloud-arrow-down"></i></div>
                    <div class="stat-number" id="countDownloads" style="font-size:3rem; font-weight:700; color:#1e293b;">...</div>
                    <div class="stat-label" style="color:#64748b; font-weight:500;">Toplam Ä°ndirme</div>
                </div>

            </div>
        </div>
    </section>

    <section class="features-section">
        <div class="container">
            <div class="section-header">
                <h2>Neden UniNot KullanmalÄ±sÄ±n?</h2>
                <p>Sadece not paylaÅŸmÄ±yoruz, Ã¶ÄŸrencilerin hayatÄ±nÄ± kolaylaÅŸtÄ±rÄ±yoruz.</p>
            </div>
            
            <div class="features-grid">
                <div class="feature-box">
                    <div class="feature-icon"><i class="fa-solid fa-wallet"></i></div>
                    <h3>Ek Gelir Elde Et</h3>
                    <p style="color:#64748b;">Kendi tuttuÄŸun notlarÄ± satarak Ã¶ÄŸrencilik bÃ¼tÃ§ene katkÄ±da bulun.</p>
                </div>
                <div class="feature-box">
                    <div class="feature-icon"><i class="fa-solid fa-award"></i></div>
                    <h3>Kaliteli Ä°Ã§erik</h3>
                    <p style="color:#64748b;">OnaylanmÄ±ÅŸ ve puanlanmÄ±ÅŸ notlarla sÄ±navlara en iyi ÅŸekilde hazÄ±rlan.</p>
                </div>
                <div class="feature-box">
                    <div class="feature-icon"><i class="fa-solid fa-infinity"></i></div>
                    <h3>SÄ±nÄ±rsÄ±z EriÅŸim</h3>
                    <p style="color:#64748b;">SatÄ±n aldÄ±ÄŸÄ±n notlara dilediÄŸin zaman, dilediÄŸin cihazdan eriÅŸ.</p>
                </div>
                <div class="feature-box">
                    <div class="feature-icon"><i class="fa-solid fa-shield-halved"></i></div>
                    <h3>GÃ¼venli Sistem</h3>
                    <p style="color:#64748b;">Supabase altyapÄ±sÄ± ile verilerin ve Ã¶demelerin gÃ¼vende.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="showcase-section" style="padding: 80px 0; background:#f1f5f9;">
        <div class="container">
            <div class="section-header">
                <h2>Vitrine Yeni DÃ¼ÅŸenler ðŸ”¥</h2>
                <p>En son paylaÅŸÄ±lan notlarÄ± keÅŸfet ve hemen Ã§alÄ±ÅŸmaya baÅŸla.</p>
            </div>

            <div class="notes-grid" id="featuredNotes">
                <div style="grid-column:1/-1; text-align:center;">
                    <i class="fa-solid fa-spinner fa-spin" style="font-size:2rem; color:#cbd5e1;"></i>
                    <p style="color:#64748b; margin-top:10px;">Vitrin yÃ¼kleniyor...</p>
                </div>
            </div>

            <div style="text-align:center; margin-top: 50px;">
                <a href="not-al.html" class="btn-primary" style="padding: 15px 40px;">TÃ¼m NotlarÄ± GÃ¶r</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-brand">
                <h2>UniNot</h2>
                <p>Ã–ÄŸrencilerin dijital kÃ¼tÃ¼phanesi ve gelir kapÄ±sÄ±.</p>
                <div class="social-links" style="margin-top:20px;">
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#"><i class="fa-brands fa-linkedin"></i></a>
                </div>
            </div>
            <div class="footer-menu">
                <h3>KeÅŸfet</h3>
                <ul>
                    <li><a href="index.html">Anasayfa</a></li>
                    <li><a href="not-al.html">Not SatÄ±n Al</a></li>
                    <li><a href="notpaylas.html">Not PaylaÅŸ</a></li>
                </ul>
            </div>
            <div class="footer-menu">
                <h3>Kurumsal</h3>
                <ul>
                    <li><a href="#">HakkÄ±mÄ±zda</a></li>
                    <li><a href="#">Ä°letiÅŸim</a></li>
                    <li><a href="#">Gizlilik PolitikasÄ±</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 UniNot. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        </div>
    </footer>

    <script type="module">
        import { supabase } from './supabase.js';

        const navAuthBtn = document.getElementById('navAuthBtn');
        const countNotes = document.getElementById('countNotes');
        const countUsers = document.getElementById('countUsers');
        const countDownloads = document.getElementById('countDownloads');
        const featuredNotes = document.getElementById('featuredNotes');

        // 1. KULLANICI GÄ°RÄ°Åž KONTROLÃœ (NavbarÄ± DÃ¼zenle)
        async function checkUser() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                navAuthBtn.innerHTML = '<i class="fa-solid fa-user"></i> HesabÄ±m';
                navAuthBtn.href = "kredilerim.html";
                navAuthBtn.style.background = "#4f46e5";
                navAuthBtn.style.color = "white";
            }
        }
        checkUser();

        // 2. CANLI Ä°STATÄ°STÄ°KLERÄ° GETÄ°R
        async function loadStats() {
            try {
                // A) Not SayÄ±sÄ±
                const { count: notesCount } = await supabase.from('notes').select('*', { count: 'exact', head: true });

                // B) Ã–ÄŸrenci SayÄ±sÄ±
                const { count: usersCount } = await supabase.from('profiles').select('*', { count: 'exact', head: true });

                // C) Toplam Ä°ndirme (Sales Count)
                const { data: downloadData } = await supabase.from('notes').select('sales_count');
                let totalDownloads = 0;
                if(downloadData) {
                    totalDownloads = downloadData.reduce((sum, item) => sum + (item.sales_count || 0), 0);
                }

                // Ekrana Yaz
                countNotes.innerText = notesCount || 0;
                countUsers.innerText = usersCount || 0;
                countDownloads.innerText = totalDownloads || 0;

            } catch (err) {
                console.error("Ä°statistik hatasÄ±:", err);
            }
        }
        loadStats();

        // 3. VÄ°TRÄ°NE SON 3 NOTU GETÄ°R
        async function loadFeaturedNotes() {
            // Ä°liÅŸkiyi ! iÅŸaretiyle belirttik ki hata almayalÄ±m
            const { data: notes, error } = await supabase
                .from('notes')
                .select('*, profiles!notes_author_id_fkey(full_name)')
                .order('created_at', { ascending: false })
                .limit(3); 

            if (error) {
                console.error(error);
                featuredNotes.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>Vitrin yÃ¼klenemedi.</p>";
                return;
            }

            renderNotes(notes);
        }

        function renderNotes(notes) {
            featuredNotes.innerHTML = "";
            
            if(!notes || notes.length === 0) {
                featuredNotes.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>HenÃ¼z not yÃ¼klenmemiÅŸ.</p>";
                return;
            }

            notes.forEach(note => {
                const colors = ['', 'color-blue', 'color-green', 'color-purple'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Yazar AdÄ± KontrolÃ¼
                let authorName = "Anonim";
                if(note.profiles && note.profiles.full_name) {
                    authorName = note.profiles.full_name;
                } else if (note.author_email) {
                    authorName = note.author_email.split('@')[0];
                }

                const cardHTML = `
                <div class="note-card">
                    <div class="card-image ${randomColor}">
                        <span class="badge-price">${note.price == 0 ? 'Ãœcretsiz' : note.price + 'â‚º'}</span>
                        <i class="fa-regular fa-file-pdf"></i>
                    </div>
                    <div class="card-body">
                        <div class="university">${note.university || 'Genel'}</div>
                        <h3 title="${note.lesson_name}">${note.lesson_name}</h3>
                        <div class="author-badge" style="font-size:0.85rem; color:#64748b; margin-bottom:10px;">
                             <i class="fa-solid fa-user-pen"></i> ${authorName}
                        </div>
                        <a href="not-al.html" class="btn-buy" style="text-align:center; display:block; text-decoration:none; margin-top:10px;">Ä°ncele</a>
                    </div>
                </div>
                `;
                featuredNotes.innerHTML += cardHTML;
            });
        }
        loadFeaturedNotes();

    </script>
</body>
</html>