<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kredilerim | UniNot</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Anasayfa.css">
    <link rel="stylesheet" href="Kredilerim.css">
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <i class="fa-solid fa-graduation-cap"></i> UniNot
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Anasayfa</a></li>
                <li><a href="not-al.html">Not SatÄ±n Al</a></li>
                <li><a href="notpaylas.html">Not PaylaÅŸ</a></li> 
                <li><button id="logoutBtn" style="background:none; border:none; color:red; font-weight:600; cursor:pointer;">Ã‡Ä±kÄ±ÅŸ Yap</button></li>
            </ul>
            <div class="hamburger">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </nav>

    <section class="dashboard-section">
        <div class="container">
            
            <div class="dashboard-header">
                <div class="welcome-text">
                    <h1>HoÅŸgeldin, <span id="userNameDisplay">YÃ¼kleniyor...</span> ðŸ‘‹</h1>
                    <p id="userUniDisplay" style="color:#666; font-size:0.9rem;">...</p>
                </div>
                
                <div class="wallet-card">
                    <div class="card-content">
                        <span>Toplam Bakiye</span>
                        <h2 id="userBalance">â‚º ...</h2>
                        <div class="card-actions">
                            <button class="btn-wallet btn-withdraw"><i class="fa-solid fa-arrow-up-from-bracket"></i> Ã‡ek</button>
                            <button class="btn-wallet btn-deposit"><i class="fa-solid fa-plus"></i> YÃ¼kle</button>
                        </div>
                    </div>
                    <div class="card-decoration">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                </div>
            </div>

            <div class="transactions-panel">
                <h3>Son Ä°ÅŸlemler</h3>
                <div class="table-responsive">
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>Ä°ÅŸlem AdÄ±</th>
                                <th>Tarih</th>
                                <th>Durum</th>
                                <th>Tutar</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody">
                            <tr>
                                <td colspan="4" style="text-align:center; padding:20px; color:#999;">
                                    Ä°ÅŸlem geÃ§miÅŸi yÃ¼kleniyor...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-brand">
                <h2>UniNot</h2>
                <p>Ã–ÄŸrencilerin dijital kÃ¼tÃ¼phanesi.</p>
            </div>
            <div class="copyright">
                <p>&copy; 2025 UniNot.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>

    <script type="module">
        import { supabase } from './supabase.js';

        const userNameDisplay = document.getElementById('userNameDisplay');
        const userUniDisplay = document.getElementById('userUniDisplay');
        const userBalance = document.getElementById('userBalance');
        const transactionsBody = document.getElementById('transactionsBody');

        async function loadUserData() {
            // 1. GiriÅŸ Yapan KullanÄ±cÄ±yÄ± Bul
            const { data: { user } } = await supabase.auth.getUser();

            if (!user) {
                // GiriÅŸ yapmamÄ±ÅŸsa at
                window.location.href = "Kayit.html";
                return;
            }

            // 2. Profil Tablosundan DetaylarÄ± Ã‡ek (Ä°sim, Okul, Bakiye)
            const { data: profile, error } = await supabase
                .from('profiles')
                .select('full_name, university, department, credits')
                .eq('id', user.id)
                .single();

            if (error) {
                console.error("Profil hatasÄ±:", error);
                userNameDisplay.innerText = "Ã–ÄŸrenci";
                return;
            }

            // 3. Verileri Ekrana Yaz
            userNameDisplay.innerText = profile.full_name || user.email.split('@')[0];
            
            if(profile.university && profile.department) {
                userUniDisplay.innerText = `${profile.university} - ${profile.department}`;
            } else {
                userUniDisplay.innerText = "Profil bilgileri eksik.";
            }

            // Bakiyeyi Yaz (Varsa yaz, yoksa 0.00 TL)
            const balance = profile.credits ? profile.credits : 0;
            userBalance.innerText = `â‚º ${parseFloat(balance).toFixed(2)}`;

            // 4. (Åžimdilik) Ä°ÅŸlem GeÃ§miÅŸi BoÅŸ UyarÄ±sÄ±
            transactionsBody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align:center; padding:20px; color:#666;">
                        HenÃ¼z bir hesap hareketiniz bulunmuyor.
                    </td>
                </tr>
            `;
        }

        loadUserData();

        // Ã‡Ä±kÄ±ÅŸ Yap Butonu
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await supabase.auth.signOut();
            window.location.href = "index.html";
        });
    </script>
</body>
</html>